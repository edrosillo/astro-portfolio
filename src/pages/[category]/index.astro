---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import GlitchText from "../../components/GlitchText.astro";

export async function getStaticPaths() {
    return [
        { params: { category: "graphic" } },
        { params: { category: "motion" } },
        { params: { category: "web" } },
    ];
}

const { category } = Astro.params;
const allProjects = await getCollection("projects");
const projects = allProjects.filter(
    (project) => project.data.category === category,
);

const categoryTitles = {
    graphic: "GRAPHIC DESIGN",
    motion: "MOTION GRAPHICS",
    web: "WEB DEVELOPMENT",
};

const title = categoryTitles[category as keyof typeof categoryTitles];
---

<MainLayout title={`Eddie's Portfolio - ${title}`}>
    <main class="container">
        <div class="back-link">
            <a href="/">&lt; RETURN TO MAP</a>
        </div>

        <header class="category-header">
            <GlitchText text={title} class="page-title" />
        </header>

        <div class="projects-grid">
            {
                projects.map((project) => (
                    <a
                        href={`/projects/${project.slug}`}
                        class={`project-card ${category}`}
                    >
                        <div class="card-image">
                            {project.data.heroImage ? (
                                <img
                                    src={project.data.heroImage}
                                    alt={project.data.title}
                                />
                            ) : (
                                <div class="placeholder-img">NO SIGNAL</div>
                            )}
                        </div>
                        <div class="card-content">
                            <h3>{project.data.title}</h3>
                            <div class="tags">
                                {project.data.tags.slice(0, 3).map((tag) => (
                                    <span>#{tag}</span>
                                ))}
                            </div>
                            <span class="press-start">PRESS START</span>
                        </div>
                    </a>
                ))
            }
        </div>

        {
            projects.length === 0 && (
                <div class="empty-state">
                    <p>NO DATA FOUND...</p>
                </div>
            )
        }
    </main>
</MainLayout>

<style>
    .back-link {
        margin-bottom: 2rem;
    }

    .category-header {
        text-align: center;
        margin-bottom: 4rem;
    }

    .page-title {
        font-size: 3rem;
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 3rem;
    }

    .project-card {
        display: block;
        border: 4px solid var(--color-dim);
        background: #000;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .project-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
    }

    .project-card.graphic:hover {
        border-color: var(--color-primary);
        box-shadow: 0 0 15px var(--color-primary);
    }
    .project-card.motion:hover {
        border-color: var(--color-secondary);
        box-shadow: 0 0 15px var(--color-secondary);
    }
    .project-card.web:hover {
        border-color: var(--color-accent);
        box-shadow: 0 0 15px var(--color-accent);
    }

    .card-image {
        height: 200px;
        background: #111;
        overflow: hidden;
        border-bottom: 4px solid var(--color-dim);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s;
    }

    .project-card:hover .card-image img {
        transform: scale(1.1);
    }

    .placeholder-img {
        color: var(--color-dim);
        font-family: var(--font-heading);
        font-size: 0.8rem;
        letter-spacing: 2px;
    }

    .card-content {
        padding: 1.5rem;
        text-align: center;
    }

    .card-content h3 {
        font-size: 1.2rem;
        margin-bottom: 1rem;
        color: var(--color-text);
    }

    .tags {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        font-size: 0.9rem;
        color: var(--color-dim);
    }

    .press-start {
        display: inline-block;
        font-family: var(--font-heading);
        font-size: 0.8rem;
        color: var(--color-text);
        animation: blink 1s infinite;
        opacity: 0;
    }

    .project-card:hover .press-start {
        opacity: 1;
    }

    .empty-state {
        text-align: center;
        padding: 4rem;
        border: 2px dashed var(--color-dim);
        color: var(--color-dim);
        font-family: var(--font-heading);
    }
</style>
