---
import { getCollection } from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import GlitchText from "../../components/GlitchText.astro";
import ConsolePlayer from "../../components/ConsolePlayer.astro";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: project,
    }));
}

const project = Astro.props;
const { Content } = await project.render();
---

<MainLayout title={project.data.title}>
    <main class="container project-detail">
        <nav class="project-nav">
            <a href={`/${project.data.category}`} class="back-link">
                <span class="arrow">←</span> BACK TO {
                    project.data.category.toUpperCase()
                }
            </a>
        </nav>

        <article class="case-study">
            <header class="project-header">
                <div class="header-content">
                    <GlitchText
                        text={project.data.title}
                        class="project-title"
                    />
                    <div class="meta">
                        <span class="date"
                            >{project.data.pubDate.toLocaleDateString()}</span
                        >
                        <div class="tags">
                            {
                                project.data.tags.map((tag) => (
                                    <span class="tag">#{tag}</span>
                                ))
                            }
                        </div>
                    </div>
                </div>
            </header>

            <div class="media-container">
                {
                    project.data.videoId ? (
                        <ConsolePlayer videoId={project.data.videoId} />
                    ) : (
                        project.data.heroImage && (
                            project.data.liveUrl ? (
                                <a href={project.data.liveUrl} target="_blank" rel="noopener noreferrer" class="hero-image-link">
                                    <div class="hero-image hover-effect">
                                        <img
                                            src={project.data.heroImage}
                                            alt={project.data.title}
                                        />
                                        <div class="link-overlay">
                                            <span>VISIT SITE →</span>
                                        </div>
                                    </div>
                                </a>
                            ) : (
                                <div class="hero-image">
                                    <img
                                        src={project.data.heroImage}
                                        alt={project.data.title}
                                    />
                                </div>
                            )
                        )
                    )
                }
            </div>

            <div class="content-wrapper">
                <div class="content">
                    <Content />
                </div>
            </div>
        </article>

        <div class="footer-nav">
            <a href="/" class="home-link">RETURN TO HOME</a>
        </div>
    </main>
</MainLayout>

<style>
    .project-detail {
        padding-top: 4rem;
    }

    .project-nav {
        margin-bottom: 4rem;
    }

    .back-link {
        font-family: var(--font-heading);
        font-size: 0.8rem;
        color: var(--color-text-muted);
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .back-link:hover {
        color: var(--color-primary);
    }

    .project-header {
        margin-bottom: 3rem;
        border-bottom: 1px solid var(--color-dim);
        padding-bottom: 2rem;
    }

    .project-title {
        font-size: 3rem;
        margin-bottom: 1rem;
        line-height: 1.1;
    }

    .meta {
        display: flex;
        gap: 2rem;
        align-items: center;
        font-family: var(--font-body);
        color: var(--color-text-muted);
    }

    .tag {
        color: var(--color-accent);
        margin-right: 1rem;
        font-size: 0.9rem;
    }

    .media-container {
        margin-bottom: 4rem;
    }

    .hero-image {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: center;
        background-color: var(--color-surface);
    }

    .hero-image img {
        max-width: 100%;
        height: auto;
        display: block;
        transition: transform 0.5s ease;
    }

    .hero-image-link {
        display: block;
        text-decoration: none;
    }

    .hover-effect {
        position: relative;
    }

    .hover-effect:hover img {
        transform: scale(1.03);
    }

    .link-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .hover-effect:hover .link-overlay {
        opacity: 1;
    }

    .link-overlay span {
        color: var(--color-primary);
        font-family: var(--font-heading);
        border: 1px solid var(--color-primary);
        padding: 0.8rem 1.5rem;
        background: rgba(0, 0, 0, 0.8);
        letter-spacing: 1px;
    }

    .content-wrapper {
        max-width: 800px;
        margin: 0 auto;
    }

    .content {
        font-family: var(--font-body);
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--color-text-muted);
    }

    /* Markdown Content Styles */
    .content :global(h1),
    .content :global(h2),
    .content :global(h3) {
        color: var(--color-text);
        margin-top: 3rem;
        margin-bottom: 1.5rem;
        font-family: var(--font-heading);
        letter-spacing: -0.02em;
    }

    .content :global(p) {
        margin-bottom: 1.5rem;
    }

    .content :global(ul) {
        padding-left: 1.5rem;
        margin-bottom: 2rem;
    }

    .content :global(li) {
        margin-bottom: 0.5rem;
    }

    .footer-nav {
        margin-top: 6rem;
        text-align: center;
        padding-top: 3rem;
        border-top: 1px solid var(--color-dim);
    }

    .home-link {
        font-family: var(--font-heading);
        font-size: 0.9rem;
        color: var(--color-text);
        border-bottom: 2px solid transparent;
        padding-bottom: 0.2rem;
    }

    .home-link:hover {
        border-color: var(--color-primary);
    }
</style>
